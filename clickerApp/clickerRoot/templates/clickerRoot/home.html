<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Counter</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script type="text/javascript">

		var socket_url = "wss://" + window.location.host+":9001" + window.location.pathname;
		console.log(window.location);
		var socket = new WebSocket(socket_url);

		var global_count = {{global_counter}};
		var click_count = {{user_c.counter}};

		socket.onmessage = function(event){
			console.log("receive ",event);
			$(".Gcount").text('Global count: '+ (JSON.parse(event.data)));
			$('#h2counter').text('total: ' + click_count);
			global_count = (JSON.parse(event.data));
		};

		socket.onopen = function(event){
			console.log("open: ",event);
			var form = $('#count_form');
			form.submit(function(e){
			console.log("in sumbit");
				e.preventDefault();
				global_count++;
				click_count++;
				var data = {
					'counter': click_count,
					'user': JSON.stringify({ {{user_c|safe}} }),
					'global_count': global_count,
				}
				socket.send(JSON.stringify(data));
			});
		};
	</script>

	{% load static %}
	<link rel="stylesheet" href="{% static 'clickerRoot/css/bootstrap.css' %} ">
	<link rel="stylesheet" href="{% static 'clickerRoot/css/font-awesome.min.css' %} ">
	<link rel="stylesheet" href="{% static 'clickerRoot/css/main.css' %} ">
	<script src="{% static 'clickerRoot/js/bootstrap.min.js' %}"></script>
	<script src="{% static 'clickerRoot/js/JavaScriptClicker.js' %}"></script>
</head>
<body onload="onLoader({{user_c.counter}})">
	<div class="navbar-inverse navbar-fixed-top">
		<div class-="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/">C<i class="fa fa-circle"></i>UNTER</a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-right">
					<li><a href="#" class="Gcount">Global count: {{global_counter}}</a></li>
                    <li><a href="#">Username: {{user_c.name}}</a></li>
					<li class="active"><a href="welcome">Log Out</a></li>
					<li><a href="https://www.jetbrains.com/pycharm/download/#section=windows">PyCharm</a></li>
					<li><a href="https://www.djangoproject.com/">Django</a></li>
					<li><a href="https://www.python.org/">Python</a></li>
					<li><a href="https://getbootstrap.com/">Bootstrap</a></li>
					<li><a href="about"><i class="fa fa-envelope-o" aria-hidden="true"></i></a></li>
				</ul>
			</div>
		</div>
	</div>
	<div id="headerwrap">
		<div class="container">
			<div class="row center">
				<div class="col-lg-8 col-lg-offset-2">
					<h1>C<i class="fa fa-circle"></i>UNTER</h1>
					<br>
					<h2 id="h2counter">total: {{user_c.counter}}</h2>
					<br>
					<br>
					<div id="videoDiv" hidden>
						<iframe width="300" height="200" src="https://www.youtube.com/embed/{{videoId}}?autoplay=1&controls=0" frameborder="0">

						</iframe>
					</div>
					<div id="button1">
						<form action="" id="count_form" method="post">
							<input type="hidden" id="usercounter" value="{{user_c.counter}}">
							<input type="hidden" id="username" value="{{user_c.name}}">
							{% csrf_token %}
							{{form.as_p}}
							<input type="submit" class= "button" value="CLICK">
						</form>
					</div>
					<br>
					<br>
				</div>
			</div>
		</div>
	</div>
	<div class="container w">
		<div class="row centered">
			<br><br>
			<div class="col-lg-4">
				<i class="fa fa-heart"></i>
				<h4>Koncepcja</h4>
				<p>Aplikacja stworzon, żeby klikać. Nic więcej. </p>
			</div>
			<div class="col-lg-4">
				<i class="fa fa-laptop"></i>
				<h4>Wykorzystywane technologie</h4>
				<p>Aplikacja była zrobiona za pomocą Bootstrap, HTML, CSS, Python z Django Framework, Javascript. </p>
			</div>
			<div class="col-lg-4">
				<i class="fa fa-trophy"></i>
				<h4>Kliknięcia</h4>
				<p>Trzeba kliknąć 1 000 000 razy, żeby zobaczyć coś ciekawe. </p>
			</div>
		</div>
		<br><br>
	</div>
</body>
</html>